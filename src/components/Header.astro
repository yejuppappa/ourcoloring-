---
import { getLocaleFromUrl, t } from "@/i18n";

const locale = getLocaleFromUrl(Astro.url);
const i18n = t(locale);
const altLocale = locale === "ko" ? "en" : "ko";
const altPath = Astro.url.pathname.replace(`/${locale}`, `/${altLocale}`);

const navItems = [
  { href: `/${locale}/gallery/`, label: i18n.nav.gallery },
  { href: `/${locale}/#converter`, label: i18n.nav.convert },
  { href: `/${locale}/how-to-print/`, label: i18n.nav.howToPrint },
];
---

<header class="sticky top-0 z-40 bg-[#FFF9F0]/80 backdrop-blur-sm border-b border-[#F0E6DA]">
  <div class="mx-auto max-w-6xl px-4 py-3 flex items-center justify-between">
    <!-- Logo -->
    <a href={`/${locale}/`} class="inline-flex items-center gap-2.5 group shrink-0">
      <img src="/favicon.svg" alt="" width="36" height="36" class="shrink-0 relative -top-[3px] transition-transform group-hover:scale-110" />
      <span class="font-['Nunito'] text-xl font-extrabold text-[#3D3530] tracking-tight leading-none">OurColoring</span>
    </a>

    <!-- Desktop Nav -->
    <nav class="hidden md:flex items-center gap-6">
      {navItems.map((item) => (
        <a
          href={item.href}
          class="text-sm font-medium text-[#5A524B] hover:text-[#FF6B4A] transition-colors"
        >
          {item.label}
        </a>
      ))}
      <a
        href={altPath}
        class="text-sm font-medium text-[#A09890] hover:text-[#3D3530] transition-colors border-l border-[#E8DFD6] pl-6"
      >
        {altLocale === "ko" ? "한국어" : "English"}
      </a>
    </nav>

    <!-- Mobile hamburger -->
    <button
      id="mobile-menu-toggle"
      class="md:hidden flex items-center justify-center w-10 h-10 rounded-lg hover:bg-[#FFF0E5] transition-colors"
      aria-label="Menu"
      aria-expanded="false"
    >
      <svg id="hamburger-icon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-[#3D3530]" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
      </svg>
      <svg id="close-icon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-[#3D3530] hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>
  </div>

  <!-- Mobile Menu -->
  <div id="mobile-menu" class="md:hidden hidden border-t border-[#F0E6DA] bg-[#FFF9F0]">
    <nav class="flex flex-col px-4 py-3 gap-1">
      {navItems.map((item) => (
        <a
          href={item.href}
          class="py-2.5 px-3 rounded-lg text-sm font-medium text-[#5A524B] hover:bg-[#FFF0E5] hover:text-[#FF6B4A] transition-colors"
        >
          {item.label}
        </a>
      ))}
      <div class="border-t border-[#F0E6DA] mt-1 pt-1">
        <a
          href={altPath}
          class="py-2.5 px-3 rounded-lg text-sm font-medium text-[#A09890] hover:bg-[#FFF0E5] hover:text-[#3D3530] transition-colors block"
        >
          {altLocale === "ko" ? "한국어" : "English"}
        </a>
      </div>
    </nav>
  </div>
</header>

<script is:inline>
(function() {
  var toggle = document.getElementById('mobile-menu-toggle');
  var menu = document.getElementById('mobile-menu');
  var hamburger = document.getElementById('hamburger-icon');
  var close = document.getElementById('close-icon');
  if (!toggle || !menu) return;

  toggle.addEventListener('click', function() {
    var open = !menu.classList.contains('hidden');
    menu.classList.toggle('hidden');
    hamburger.classList.toggle('hidden');
    close.classList.toggle('hidden');
    toggle.setAttribute('aria-expanded', String(!open));
  });

  // Close on link click
  menu.querySelectorAll('a').forEach(function(a) {
    a.addEventListener('click', function() {
      menu.classList.add('hidden');
      hamburger.classList.remove('hidden');
      close.classList.add('hidden');
      toggle.setAttribute('aria-expanded', 'false');
    });
  });
})();
</script>
