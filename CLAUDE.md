# Claude.md — OurColoring 프로젝트 가이드

## 🎯 프로젝트 정체성

**OurColoring**은 색칠 놀이 + 학습 + 창의 활동이 결합된 종합 색칠공부 플랫폼이다.

- **핵심 가치:** "색칠하면서 놀고, 배우고, 만든다." 단순한 색칠 도안 사이트가 아니라, 아이의 놀이·학습·창의력을 색칠이라는 하나의 경험으로 통합하는 플랫폼.
- **슬로건 방향:** "아이 사진도 색칠하고, 영어 공부도 되는 무료 색칠 도안 사이트"
- **차별점:**
  - 기존 색칠공부 사이트: 고정 도안만 제공
  - Gemini/ChatGPT: 프롬프트 입력 필요, 프린트 최적화 없음
  - **우리:** 놀이(A) + 교육(B) + 창의(C) 도안 갤러리 + 사진→도안 AI 변환 + Color by Number + 이름 도안 생성까지
- **타겟:** 3~10세 자녀를 둔 부모 (한국 + 글로벌 동시). 네이버에 "색칠공부 도안"을 검색하는 한국 엄마, Google/Bing에서 "free coloring pages"를 검색하는 해외 부모가 우리 고객.

### 서비스 3대 축

| 축 | 역할 | 설명 |
|---|------|------|
| 🎨 **놀이 도안 (A)** | Traffic 담당 | 공룡, 자동차, 동물, 유니콘, 직업, 계절 이벤트 등 — 검색 유입의 주력 |
| 📚 **교육 도안 (B)** | 차별화 핵심 ⭐ | Alphabet+Animal, Number Coloring, Color by Number, World Culture(국기+문화), Name Coloring — 부모가 "이건 다르다"고 느끼는 핵심 |
| 🧠 **창의 도안 (C)** | 킬러 콘텐츠 | 다음 장면 그리기, 반쪽 그림 완성, 빈 캐릭터 디자인, 나만의 공룡 만들기 — 경쟁사 거의 없음, 단순 색칠→창의 활동으로 승격 |

### 사진 변환 기능 (기존 핵심 유지)
- "내 아이 사진, 우리집 거실, 아이의 장난감" → 색칠공부 도안으로 변환
- 3가지 배경 모드 + 3단계 난이도
- 이것은 갤러리와 별개로 메인 페이지의 핵심 도구로 유지

### 왜 AI 챗봇이 아니라 전용 서비스인가
1. **프롬프트 불필요** — 사진 찍고 버튼 한 번. 아이도 직접 할 수 있다.
2. **프린트 최적화** — A4 PDF, 적절한 여백. AI 챗봇 결과물로 이걸 하려면 5단계 더 거쳐야 한다.
3. **무료 + 즉시 사용** — 로그인 없음, 앱 설치 없음, AI 구독 없음.
4. **색칠공부 전용 UX** — 3가지 배경 모드, 3단계 난이도, 아이 연령에 맞는 결과물.
5. **갤러리 + 도구 결합** — 기성 도안 다운로드 + 내 사진 변환이 한 사이트에.
6. **검색 유입** — "색칠공부 도안"으로 검색하는 사람은 AI 챗봇이 아니라 색칠공부 사이트로 간다.

---

## 🏗️ 기술 스택

| 영역 | 선택 | 이유 |
|------|------|------|
| 프레임워크 | **Astro** | 정적 사이트 최적화, Cloudflare 궁합, 빠른 빌드 |
| 인터랙티브 UI | **React (Astro Islands)** | 업로드/변환 등 동적 부분만 React로 처리 |
| AI 이미지 변환 | **Grok Image API (xAI)** | 빠른 속도, 저렴한 비용(실측 $0.013~$0.02/장), 저작권 캐릭터 지원 |
| 서버사이드 | **Cloudflare Workers/Functions** | API 키 보호, 서버사이드 AI 호출, 관리자 API 처리 |
| 이미지 저장 | **Cloudflare R2** | 갤러리 도안 이미지 저장, 무료 10GB |
| 데이터 저장 | **Cloudflare D1 또는 KV** | 도안 메타데이터 저장, Claude Code가 적합한 쪽 선택 |
| 스타일링 | **Tailwind CSS** | Astro 기본 지원, 빠른 개발 |
| 배포 | **Cloudflare Pages** | 무제한 대역폭, 상업적 무료 |
| 다국어 | **정적 라우팅 기반 i18n** | /ko/, /en/ 경로 분리 |

---

## 📐 아키텍처 원칙

### AI API 서버사이드 처리
- 이미지 변환은 **Cloudflare Workers/Functions를 통해 서버사이드에서** Grok Image API를 호출한다.
- **Why:** API 키를 클라이언트에 노출하면 안 되고, AI 처리는 서버에서만 가능하다.
- 사용자가 업로드한 이미지는 API 호출에만 사용되며, **서버에 저장하지 않는다.**
- 처리 완료 후 결과 이미지만 클라이언트에 반환한다.

### 정적 + 동적 하이브리드
- 랜딩 페이지, 가이드 페이지 등은 Astro SSG로 빌드 타임에 생성 (정적).
- **갤러리 페이지는 동적:** R2/D1에서 실시간으로 데이터를 가져와 렌더링 (Astro SSR + Cloudflare).
- AI 변환 API, 관리자 API는 Cloudflare Workers/Functions로 처리.
- **Why:** 갤러리 콘텐츠가 관리자 업로드로 수시로 추가되므로 동적 렌더링이 필수.

### 콘텐츠 관리 구조
- **관리자 업로드 페이지 (`/admin/`):** 운영자(승수)가 사이트에서 직접 도안을 일괄 업로드하고 메타데이터(카테고리, 난이도, 이름 등)를 입력
- **이미지 저장:** Cloudflare R2 (무료 티어 10GB)
- **메타데이터 저장:** Cloudflare D1 또는 KV (Claude Code 자율 선택)
- **갤러리 반영:** 업로드 즉시 반영 (빌드 불필요, 동적 렌더링)
- **관리자 인증:** 비밀번호 보호 (승수만 접근)
- **향후:** 트래픽/데이터 증가 시 유료 서버 운영 방식으로 전환 가능성 있음
- **How(폴더 구조, 메타데이터 스키마, 관리자 UI 등):** Claude Code 자율 결정

### 점진적 향상
- JavaScript 없이도 랜딩 페이지, 갤러리 페이지는 읽을 수 있어야 한다.
- 변환 기능은 React Island로 클라이언트에서 hydrate.

---

## 📄 페이지 구조

```
/ (또는 /ko/)                    → 랜딩 + 사진→도안 변환 도구 (메인)
/en/                             → 영어 랜딩 + 변환 도구

/ko/gallery/                     → 갤러리 메인 (전체 카테고리 한눈에)
/en/gallery/                     → Gallery main

/ko/gallery/play/                → 🎨 놀이 도안 (A)
/ko/gallery/play/dinosaur/       → 공룡 도안 모음
/ko/gallery/play/car/            → 자동차 도안 모음
/ko/gallery/play/animal/         → 동물 도안 모음
/ko/gallery/play/unicorn/        → 유니콘 도안 모음
/ko/gallery/play/jobs/           → 직업 도안 모음
/ko/gallery/play/seasonal/       → 계절/이벤트 도안 모음
(영어: /en/gallery/play/... 동일 구조)

/ko/gallery/education/           → 📚 교육 도안 (B)
/ko/gallery/education/alphabet/  → 알파벳 + 동물
/ko/gallery/education/numbers/   → 숫자 색칠
/ko/gallery/education/color-by-number/ → Color by Number
/ko/gallery/education/world-culture/   → 세계 문화 (국기+문화)
/ko/gallery/education/name/      → 이름 색칠
(영어: /en/gallery/education/... 동일 구조)

/ko/gallery/creative/            → 🧠 창의 도안 (C)
/ko/gallery/creative/next-scene/ → 다음 장면 그리기
/ko/gallery/creative/half-drawing/ → 반쪽 그림 완성
/ko/gallery/creative/character-design/ → 빈 캐릭터 디자인
/ko/gallery/creative/my-dinosaur/  → 나만의 공룡 만들기
(영어: /en/gallery/creative/... 동일 구조)

/ko/how-to-print/                → 프린트 가이드
/en/how-to-print/                → Print guide
/ko/about/                       → 소개
/en/about/                       → About
/ko/privacy/                     → 개인정보처리방침
/en/privacy/                     → Privacy Policy
/ko/terms/                       → 이용약관
/en/terms/                       → Terms of Service
/ko/contact/                     → 문의하기
/en/contact/                     → Contact
```

### 페이지 구조 원칙
- **What:** 위 URL 구조를 따른다.
- **Why:** 카테고리별 URL 분리는 SEO에 필수. 각 카테고리가 독립적인 검색 유입 채널이 된다.
- **제약조건:**
  - 한국어(/ko/)와 영어(/en/) 동일 구조
  - 카테고리 하위에 개별 도안 페이지도 가능 (SEO용)
  - 갤러리 메인에서 A/B/C 카테고리가 시각적으로 명확히 구분되어야 함
  - 하위 카테고리 추가가 용이한 확장 가능한 구조

---

## 🎨 갤러리 시스템

### What
운영자가 제작한 도안 이미지를 카테고리별로 전시하고, 사용자가 무료로 다운로드/프린트할 수 있는 시스템.

### Why
- 검색 유입의 핵심 채널 (SEO)
- 사이트 신뢰도 향상 (콘텐츠가 풍부한 사이트 = 신뢰)
- 사진 변환 기능으로의 자연스러운 전환 유도
- AdSense 승인 요건 충족

### 갤러리 도안 제공 방식
- **콘텐츠 제작:** 운영자(승수)가 직접 제작하여 업로드
- **시스템 역할:** 이미지 파일이 정해진 위치에 추가되면 갤러리에 자동 반영
- **각 도안에 포함되어야 할 정보:**
  - 도안 이미지 (흑백 선화)
  - 카테고리 (A/B/C 중)
  - 서브카테고리 (공룡, 알파벳 등)
  - 난이도 (상/중/하)
  - 타겟 연령
  - 한국어 이름 + 영어 이름
  - SEO용 설명 텍스트

### 제약조건
- 도안 이미지는 프린트 최적화 (A4, 흑백, 선명한 선)
- 각 도안 개별 페이지 생성 (SEO용 — 개별 URL이 검색에 노출)
- 다운로드: PNG + PDF 모두 지원
- "OurColoring" 워터마크 (하단 작게)
- 갤러리 내 정렬/필터 기능 (난이도별, 연령별, 인기순 등)
- How(파일 관리 방식, 메타데이터 포맷, 빌드 방식): Claude Code 자율

---

## ⚙️ 핵심 기능 명세

### 1. 사진→도안 AI 변환 (기존 유지)
- **What:** 사용자가 사진을 업로드하면 AI가 색칠공부 선화로 변환
- **Why:** 서비스의 원조 핵심 기능. 갤러리와 함께 양대 축.

#### 배경 모드 (3가지, 사용자 선택)

| 모드 | 설명 | 프롬프트 6번 조건 |
|------|------|-----------------|
| 🖼️ **배경 유지** | 원본 배경을 살려서 함께 변환 | "주변 배경도 그대로 색칠도안으로 바꿔줘." |
| ✂️ **배경 제거** | 주인공만 깔끔하게 추출 | "주변 배경은 제거해줘." |
| 🎨 **배경 창작** | AI가 어울리는 배경을 새로 생성 | "주변 배경은 기존 배경을 사용하지 않고, 주인공과 어울리게 꾸며줘." |

#### 난이도 (3단계, 사용자 선택)

| 난이도 | 타겟 연령 | 프롬프트 추가 | 특징 |
|--------|----------|-------------|------|
| **상 (기본값)** | 10세+ | 없음 | 실물 유사도 최대, 디테일 풍부 |
| **중** | 7~9세 | "7~9살 아이가 색칠할 수 있도록, 큰 윤곽선까지만 단조롭게 그려줘" | 적당한 단순화 |
| **하** | 4~6세 | "4~6살 아이가 색칠할 수 있도록 큰 윤곽선만 단순하게 그려줘" | 최대 단순화, 큰 영역 |

#### 확정 프롬프트 v1 (100장 테스트 완료)

```
이 사진을 아래의 조건을 지켜서 색칠도안으로 바꿔줘.
조건
1. 재생성된 색칠 도안은 색상 절대 없이, 반드시 흰 바탕에 검정 선만 있어야 해.
   검정색으로 색칠된 부분도 없어야 돼.
2. 색칠 도안으로 변경된 주인공은 사진과 최대한 비슷해야 해.
3. 피부색, 머리카락 색 등 모든 색상을 제거하고 윤곽선만 남겨줘
4. 주인공의 내부 선밀도를 50%로 낮춰줘.
5. 인형의 경우 봉제선을 없애줘.
6. [배경 모드별 지시 — 위 표 참고]
[난이도가 상이 아닌 경우, 여기에 난이도 문장 추가]
```

- **제약조건:**
  - Cloudflare Workers/Functions를 통한 서버사이드 API 호출
  - Grok Image API (xAI) 사용
    - `grok-imagine-image`: **실측 $0.013/장, 최대 $0.02/장, 300 rpm — 확정 모델**
    - `grok-imagine-image-pro`: $0.07/장, 30 rpm — 향후 프리미엄 옵션으로 고려 가능
  - **API 엔드포인트:** `https://api.x.ai/v1/images/edits` (⚠️ /generations 아님!)
  - **image 파라미터:** `{ url: "data:...", type: "image_url" }` (객체 형태)
  - API 키는 환경변수로 관리, 클라이언트 노출 금지
  - 업로드된 이미지는 API 호출에만 사용, 서버 저장 금지

### 2. 갤러리 도안 다운로드
- **What:** 갤러리의 기성 도안을 PNG/PDF로 다운로드
- **Why:** 사용자가 프린트해서 아이가 색칠하는 것이 최종 목표
- **제약조건:**
  - PNG: 원본 해상도 유지
  - PDF: A4 사이즈, 여백 포함, 프린트 최적화
  - 각 도안 페이지에서 바로 다운로드 가능
  - 파일명: ourcoloring_[category]_[name].png/pdf

### 3. 사진 변환 결과 다운로드
- **What:** AI 변환된 도안을 PNG 또는 PDF로 다운로드
- **제약조건:**
  - PNG: 원본 해상도 유지
  - PDF: A4 사이즈, 여백 포함, 프린트 최적화
  - 파일명: ourcoloring_[timestamp].png/pdf

### 4. 일일 무료 제한 + 이메일 해제 + 유료 플랜
- **What:** 사진→도안 AI 변환은 하루 3장까지 무료. 이메일 등록 시 하루 10장. 이후 충전팩/구독.
- **Why:** AI API는 건당 비용 발생. 갤러리 도안 다운로드는 무제한 무료.
- **제약조건 (MVP):**
  - 갤러리 도안 다운로드: **무제한 무료** (트래픽 유입 목적)
  - AI 변환: 로컬스토리지 기반 일일 카운팅 (기존과 동일)
  - 자정(사용자 로컬 시간) 기준 리셋

### 5. 다국어 (i18n)
- URL 경로 기반 (/ko/, /en/)
- 한국어 + 영어 동시 지원
- 갤러리 도안의 이름/설명도 양국어

### 6. 소셜 공유
- 카카오톡 공유 + 링크 복사
- 개별 도안 페이지도 공유 가능

### 7. 분석 도구
- GA4 (**G-2RWZCY0YPM**) + Clarity (`vkdvv8w5sd`)
- 이벤트: 변환 완료, 다운로드(AI변환/갤러리 구분), 모드 선택, 난이도 선택, 공유, 갤러리 카테고리 조회

---

## 📱 반응형 디자인 (3단계)

### What
모바일 + 태블릿 + PC 각각에 최적화된 UI/UX 제공.

### Why
- 모바일: 주 사용 디바이스 (부모가 폰으로 사진 찍고 바로 변환)
- 태블릿: 아이가 직접 색칠할 수 있는 디바이스, 갤러리 탐색에 적합
- PC: 검색 유입 사용자, 대량 다운로드/프린트 사용자

### 제약조건
- **모바일 (~ 767px):** 기존 모바일 최적화 유지
- **태블릿 (768px ~ 1023px):** 갤러리는 그리드 확장, 변환 도구는 여유 있는 레이아웃
- **PC (1024px ~):** 갤러리 와이드 그리드, 변환 도구 좌우 배치, 충분한 여백
- 브레이크포인트, 그리드 컬럼 수, 세부 레이아웃: Claude Code 자율

---

## 🔮 향후 추가 기능 (Phase 3+)

### ⭐ Color by Number 생성
- **What:** 사진 또는 도안을 Color by Number 형태로 자동 생성
- **Why:** 교육 느낌 강함, 체류시간 증가, 부모 만족도 높음, 해외 트래픽 핵심 포맷
- **시점:** 갤러리 시스템 안정화 후

### ⭐ 이름 입력 → 도안 생성
- **What:** 아이 이름을 입력하면 이름이 포함된 맞춤 도안 즉시 생성
- **Why:** 개인화 경험, 기존 AI 이미지 생성 기술 응용 가능
- **시점:** 갤러리 시스템 안정화 후

---

## 📢 AdSense 승인 준비

### What
Google AdSense 승인을 위해 사이트가 갖춰야 할 요건.

### Why
광고 수익은 무료 서비스 지속의 핵심 수익원. AdSense 승인은 콘텐츠 양 + 사이트 품질 + 필수 페이지가 모두 갖춰져야 함.

### 필수 페이지 (AdSense 심사 전 반드시 구현)
- **개인정보처리방침 (/privacy/):** 사진 업로드 처리 방식, 쿠키, GA4/Clarity 데이터 수집 등 명시
- **이용약관 (/terms/):** 서비스 이용 조건, 면책 사항
- **문의하기 (/contact/):** 이메일 또는 문의 폼
- **소개 (/about/):** 서비스 소개, 운영자 정보

### 사이트 구조 요건
- 모든 페이지에 고유한 `<title>` + `<meta description>`
- 시멘틱 HTML: `<nav>`, `<main>`, `<article>`, `<footer>` 적절히 사용
- **푸터(Footer):** 모든 페이지 하단에 개인정보처리방침, 이용약관, 문의하기 링크 포함
- 콘텐츠와 광고 영역이 명확히 구분되는 레이아웃

### 콘텐츠 양 요건
- 갤러리 도안 최소 20개 이상 (카테고리별 분산)
- 블로그/가이드 콘텐츠 3~5개 이상 권장
- 얇은 콘텐츠(thin content) 페이지 없어야 함 — 모든 페이지에 실질적 가치

### 제약조건
- 필수 페이지의 법적 내용은 운영자(승수)가 확인 및 제공
- 페이지 템플릿과 구조는 Claude Code 자율
- 광고 배치 위치는 AdSense 승인 후 결정 (승인 전에는 광고 코드 삽입하지 않음)

---

### 기존 키워드 (사진 변환)
- "사진 색칠공부 만들기", "사진으로 색칠도안 만들기", "내 사진 색칠공부"

### 갤러리 키워드 (신규 — 대량 유입 기대)
- **놀이:** "공룡 색칠공부", "자동차 색칠도안", "동물 색칠공부 무료"
- **교육:** "알파벳 색칠공부", "숫자 색칠도안", "Color by Number 무료"
- **창의:** "창의 색칠공부", "그림 완성하기 도안"
- **영어:** "free coloring pages", "dinosaur coloring pages", "alphabet coloring pages"

### SEO 실행
- 네이버 웹마스터 인증 완료, Google Search Console 등록 완료
- hreflang, OG, 구조화 데이터 적용
- 각 갤러리 도안 개별 페이지 = 개별 검색 유입 채널

---

## 🚫 하지 않는 것 (현재 단계)

- 사용자 계정/로그인, 소셜 로그인
- 이미지 서버 저장 (사용자 업로드 사진)
- 다크모드
- 결제 시스템 (Phase 3)
- Edge Detection (폐기됨)

---

## 🔧 외부 서비스 키 & ID

| 서비스 | ID/키 | 비고 |
|--------|-------|------|
| GA4 | **G-2RWZCY0YPM** | ⚠️ W임, N 아님 |
| Clarity | vkdvv8w5sd | |
| 카카오 JS키 | cc0642129bab260c8791d9de19ca5e46 | 앱 ID: 1390100 |
| 네이버 인증 | edb3efc31035cbfe5e824585be1cd9a5aebacfac | 인증 완료 |
| Grok API | (환경변수로 관리) | 하드코딩 금지 |

---

## 💡 Claude Code를 위한 핵심 지침

1. **이 문서의 What/Why/제약조건을 따른다.** How는 자율.
2. **Design_Skills.md를 참고하여** 디자인 퀄리티를 높인다.
3. **모바일 퍼스트 + 태블릿/PC 반응형.** Lighthouse 90+ 목표.
4. **한국어 + 영어** 텍스트는 i18n 파일에서 관리.
5. **API 키 보안:** 환경변수로만 관리.
6. **프롬프트는 이 문서의 확정본을 사용.** 임의 수정 금지.
7. **갤러리 시스템:** 운영자가 도안 파일을 추가하면 자동으로 반영되는 구조로 설계. 파일 관리 방식은 자율.
8. **문서 자율 업데이트 권한:** 중요 변화 시 Claude.md, Design_Skills.md 직접 업데이트. 변경 이력 기록.

---

## 🔑 의사결정 기록

| 결정 | 선택 | 이유 |
|------|------|------|
| AI 엔진 | Grok (xAI) | 속도↑, 비용↓(실측 $0.013/장), 저작권 캐릭터 지원. GPT는 품질↑이나 비용↑, 저작권 거부 |
| API 엔드포인트 | /v1/images/edits | /generations는 텍스트→이미지 생성용. 사진 변환은 /edits 사용 필수 |
| 프롬프트 언어 | 한국어 | Grok은 짧고 자연스러운 한국어 지시에 최적 반응 |
| Edge Detection | 폐기 | 캐니/소벨 품질 미달 |
| 프레임워크 | Astro + Cloudflare | 정적 최적화, 무제한 대역폭, 무료 |
| 서비스 방향 | 종합 색칠 플랫폼 | 사진 변환 단일 도구 → 놀이+교육+창의 갤러리 + AI 변환 결합 |
| 갤러리 콘텐츠 | 운영자 직접 제작 | AI 자동 생성 아닌 수동 제작으로 품질 보장 |
| 다국어 | 한국어 + 영어 동시 | 한국 검증 후 글로벌이 아니라, 처음부터 양시장 동시 진입 |
| 반응형 | 3단계 (모바일/태블릿/PC) | 모바일만 최적화 → 태블릿(아이 사용)+PC(검색 유입) 모두 커버 |
| 갤러리 저장소 | Cloudflare R2 + D1/KV | 무료 티어로 충분, git push 없이 관리자 페이지에서 즉시 업로드. 향후 유료 서버 전환 가능 |
| 갤러리 렌더링 | 동적 (SSR) | 관리자가 수시로 콘텐츠 추가하므로 정적 빌드 방식 부적합 |

---

## 📝 변경 이력
| 날짜 | 변경 내용 |
|------|----------|
| 프로젝트 시작 | 초기 문서 작성 |
| 2026-02-20 | Sprint 1~4 완료 (Astro, Edge Detection, 다운로드, 공유, 랜딩, GA4, SEO) |
| 2026-02-22 | Edge Detection → AI API 전환 결정 |
| 2026-02-22 | GA4 ID 수정 (N→W), 네이버 웹마스터 인증 완료 |
| 2026-02-23 | AI 엔진 확정: Grok (xAI), 기능 3가지, 난이도 3단계 |
| 2026-02-23 | 한국어 프롬프트 v1 확정 (100장 테스트 완료) |
| 2026-02-24 | Sprint 5 완료: Grok API 연동 LIVE |
| 2026-02-24 | 비용 실측: 평균 $0.013/장 |
| 2026-02-27 | **🔄 방향 전환: 사진 변환 도구 → 종합 색칠 플랫폼** |
| 2026-02-27 | 갤러리 시스템 추가 (놀이A/교육B/창의C 3대 축) |
| 2026-02-27 | 반응형 3단계 확장 (모바일+태블릿+PC) |
| 2026-02-27 | 다국어 전략 변경: 한국어 우선 → 한국어+영어 동시 |
| 2026-02-27 | 향후 기능 추가: Color by Number, 이름→도안 생성 |
