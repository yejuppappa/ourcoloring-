# Claude.md — OurColoring 프로젝트 가이드

## 🎯 프로젝트 정체성

**OurColoring**는 사용자가 사진을 업로드하면 AI가 색칠공부 도안(선화)으로 변환해주는 웹 서비스다.

- **핵심 가치:** "내 아이 사진, 우리집 거실, 아이의 장난감" — 주변 모든 것이 색칠공부가 된다. 아이가 직접 찍고, 변환하고, 색칠하는 "찍고-칠하고" 루프로 재방문을 만든다.
- **차별점:** 기존 색칠공부 사이트는 고정 도안을 제공한다. Gemini/ChatGPT는 사진을 스케치로 바꿀 수 있지만 프롬프트 입력이 필요하고 프린트 최적화가 안 된다. 우리는 **"탭 한 번으로 A4 색칠공부 도안 완성"**이라는 경험을 제공한다.
- **타겟:** 3~10세 자녀를 둔 한국 부모 (1차), 글로벌 영어권 부모 (2차). AI를 쓸 줄 아는 사람이 아니라, 네이버에 "색칠공부 도안"을 검색하는 엄마가 우리 고객이다.

### 왜 AI 챗봇이 아니라 전용 서비스인가
1. **프롬프트 불필요** — 사진 찍고 버튼 한 번. 아이도 직접 할 수 있다.
2. **프린트 최적화** — A4 PDF, 적절한 여백. AI 챗봇 결과물로 이걸 하려면 5단계 더 거쳐야 한다.
3. **무료 + 즉시 사용** — 로그인 없음, 앱 설치 없음, AI 구독 없음.
4. **색칠공부 전용 UX** — 3가지 배경 모드, 3단계 난이도, 아이 연령에 맞는 결과물.
5. **검색 유입** — "색칠공부 도안"으로 검색하는 사람은 AI 챗봇이 아니라 색칠공부 사이트로 간다.

---

## 🏗️ 기술 스택

| 영역 | 선택 | 이유 |
|------|------|------|
| 프레임워크 | **Astro** | 정적 사이트 최적화, Cloudflare 궁합, 빠른 빌드 |
| 인터랙티브 UI | **React (Astro Islands)** | 업로드/변환 등 동적 부분만 React로 처리 |
| AI 이미지 변환 | **Grok Image API (xAI)** | 빠른 속도, 저렴한 비용($0.02~$0.07/장), 저작권 캐릭터 지원, Data Sharing 이벤트로 월 $150 크레딧 무료 |
| 서버사이드 | **Cloudflare Workers/Functions** | API 키 보호, 서버사이드 AI 호출 처리 |
| 스타일링 | **Tailwind CSS** | Astro 기본 지원, 빠른 개발 |
| 배포 | **Cloudflare Pages** | 무제한 대역폭, 상업적 무료 |
| 다국어 | **정적 라우팅 기반 i18n** | /ko/, /en/ 경로 분리 |

---

## 📐 아키텍처 원칙

### AI API 서버사이드 처리
- 이미지 변환은 **Cloudflare Workers/Functions를 통해 서버사이드에서** Grok Image API를 호출한다.
- **Why:** API 키를 클라이언트에 노출하면 안 되고, AI 처리는 서버에서만 가능하다.
- 사용자가 업로드한 이미지는 API 호출에만 사용되며, **서버에 저장하지 않는다.**
- 처리 완료 후 결과 이미지만 클라이언트에 반환한다.

### 정적 우선
- Astro의 정적 생성(SSG)을 기본으로 한다.
- AI 변환 API 엔드포인트만 서버사이드(Cloudflare Functions)로 처리한다.
- 랜딩 페이지, 가이드 페이지 등은 빌드 타임에 생성한다.

### 점진적 향상
- JavaScript 없이도 랜딩 페이지는 읽을 수 있어야 한다.
- 변환 기능은 React Island로 클라이언트에서 hydrate.
- 핵심 플로우: 업로드 → 배경 모드 선택 → 난이도 선택 → AI 변환 → 결과 확인 → 다운로드.

---

## 🎨 디자인 방향

### 톤 & 무드
- **따뜻하고 친근한** — 차가운 테크 느낌 ✗
- **깔끔하지만 재미있는** — 과한 장식 ✗, 완전 미니멀 ✗
- **신뢰감 있는** — 부모가 아이 사진을 올리는 서비스이므로 안전한 느낌 필수

### 컬러
- 밝고 따뜻한 파스텔 톤 기반
- 강한 CTA 컬러로 액센트 (변환 버튼 등)
- 다크모드는 MVP에서 제외

### 타이포그래피
- 한국어: 부드럽고 친근한 서체 (예: Pretendard, Noto Sans KR 등)
- 영어: 둥글고 따뜻한 느낌의 서체
- 자세한 서체 선택은 Claude Code가 디자인 스킬을 참고하여 자율 결정

### 레이아웃
- 모바일 퍼스트 (사용자의 70%+ 가 모바일)
- 업로드 → 결과 플로우는 한 페이지 내에서 완결
- 불필요한 페이지 이동 최소화

---

## 📄 페이지 구조

```
/ (또는 /ko/)          → 랜딩 + 변환 도구 (메인)
/en/                   → 영어 랜딩 + 변환 도구
/ko/how-to-print/      → 프린트 가이드
/en/how-to-print/      → Print guide
/ko/about/             → 소개
/en/about/             → About
```

---

## ⚙️ 핵심 기능 명세

### 1. 이미지 업로드
- **What:** 사용자가 사진을 선택하거나 카메라로 촬영하여 업로드
- **Why:** 변환의 시작점. 모바일 사용자가 대부분이므로 카메라 촬영도 지원해야 함
- **제약조건:**
  - 허용 포맷: JPEG, PNG, WebP
  - 최대 파일 크기: 10MB
  - 드래그앤드롭 + 클릭 선택 + 모바일 카메라 모두 지원

### 2. AI 도안 변환 (Grok Image API)
- **What:** 업로드된 사진을 AI가 색칠공부 선화(흑백 윤곽선)로 변환
- **Why:** 핵심 가치 — 사진이 색칠공부가 되는 마법의 순간.

#### 배경 모드 (3가지, 사용자 선택)

| 모드 | 설명 | 프롬프트 6번 조건 |
|------|------|-----------------|
| 🖼️ **배경 유지** | 원본 배경을 살려서 함께 변환 | "주변 배경도 그대로 색칠도안으로 바꿔줘." |
| ✂️ **배경 제거** | 주인공만 깔끔하게 추출 | "주변 배경은 제거해줘." |
| 🎨 **배경 창작** | AI가 어울리는 배경을 새로 생성 | "주변 배경은 기존 배경을 사용하지 않고, 주인공과 어울리게 꾸며줘." |

#### 난이도 (3단계, 사용자 선택)

| 난이도 | 타겟 연령 | 프롬프트 추가 | 특징 |
|--------|----------|-------------|------|
| **상 (기본값)** | 10세+ | 없음 | 실물 유사도 최대, 디테일 풍부 |
| **중** | 7~9세 | "7~9살 아이가 색칠할 수 있도록, 큰 윤곽선까지만 단조롭게 그려줘" | 적당한 단순화 |
| **하** | 4~6세 | "4~6살 아이가 색칠할 수 있도록 큰 윤곽선만 단순하게 그려줘" | 최대 단순화, 큰 영역 |

#### 확정 프롬프트 v1 (100장 테스트 완료)

```
이 사진을 아래의 조건을 지켜서 색칠도안으로 바꿔줘.
조건
1. 재생성된 색칠 도안은 색상 절대 없이, 반드시 흰 바탕에 검정 선만 있어야 해.
2. 색칠 도안으로 변경된 주인공은 사진과 최대한 비슷해야 해.
3. 피부색, 머리카락 색 등 모든 색상을 제거하고 윤곽선만 남겨줘
4. 주인공의 내부 선밀도를 50%로 낮춰줘.
5. 인형의 경우 봉제선을 없애줘.
6. [배경 모드별 지시 — 위 표 참고]
[난이도가 상이 아닌 경우, 여기에 난이도 문장 추가]
```

- **제약조건:**
  - Cloudflare Workers/Functions를 통한 서버사이드 API 호출
  - Grok Image API (xAI) 사용
    - `grok-imagine-image`: **$0.02/장, 300 rpm — 확정 모델** (무료 플랜 테스트 완료, 품질 충분)
    - `grok-imagine-image-pro`: $0.07/장, 30 rpm — 향후 프리미엄 옵션으로 고려 가능
  - API 키는 환경변수로 관리, 클라이언트 노출 금지
  - 업로드된 이미지는 API 호출에만 사용, 서버 저장 금지
  - **Data Sharing 이벤트:** $5 충전 + 학습 동의 → 매달 $150 크레딧 무료 (기본 모델 기준 월 7,500장)

### 3. 다운로드
- **What:** 변환된 도안을 PNG 또는 PDF로 다운로드
- **Why:** 최종 목표는 프린트해서 아이가 색칠하는 것
- **제약조건:**
  - PNG: 원본 해상도 유지
  - PDF: A4 사이즈, 여백 포함, 프린트 최적화
  - 파일명: ourcoloring_[timestamp].png/pdf

### 4. 일일 무료 제한 + 이메일 해제 + 유료 플랜
- **What:** 하루 3장까지 무료 변환. 이메일 등록 시 하루 10장으로 확대. 이후 충전팩 또는 월 구독.
- **Why:** AI API는 건당 비용 발생하지만, Grok 비용이 낮아($0.07/장) 이메일 수집 대가로 10장 제공 가능. 이메일은 수요 검증 + 유료 전환 채널로 활용.
- **MVP 단계:** 무료 3장 + 이메일 등록 시 10장. 결제는 MVP 이후.
- **제약조건 (MVP):**
  - 로컬스토리지 기반 일일 카운팅
  - 자정(사용자 로컬 시간) 기준 리셋
  - 남은 횟수 표시
  - 3장 소진 시: "이메일을 남기면 하루 10장까지 무료로 이용할 수 있어요!" + 이메일 입력 폼
  - 이메일 인증 없음. 포맷 검증만 (@ 포함, 도메인 형식)
  - 이메일 입력 후 로컬스토리지에 해제 플래그 저장
  - 이메일 수집 백엔드는 자율 (Cloudflare Workers KV, Google Form 등)

### 5. 다국어 (i18n)
- URL 경로 기반 (/ko/, /en/), 한국어 기본

### 6. 소셜 공유
- 카카오톡 공유 + 링크 복사

### 7. 분석 도구
- GA4 (**G-2RWZCY0YPM**) + Clarity (`vkdvv8w5sd`)
- 이벤트: 변환 완료, 다운로드, 모드 선택, 난이도 선택, 공유

---

## 🔍 SEO 키워드 전략

### 블루오션 키워드
- "사진 색칠공부 만들기", "사진으로 색칠도안 만들기", "내 사진 색칠공부"

### SEO 실행
- 네이버 웹마스터 인증 완료, Google Search Console 등록 완료
- hreflang, OG, 구조화 데이터 적용

---

## 🚫 하지 않는 것 (MVP)

- 사용자 계정/로그인, 소셜 로그인
- 이미지 서버 저장
- 다크모드
- 결제 시스템 (MVP 이후)
- Edge Detection (폐기됨)

---

## 🔧 외부 서비스 키 & ID

| 서비스 | ID/키 | 비고 |
|--------|-------|------|
| GA4 | **G-2RWZCY0YPM** | ⚠️ W임, N 아님 |
| Clarity | vkdvv8w5sd | |
| 카카오 JS키 | cc0642129bab260c8791d9de19ca5e46 | 앱 ID: 1390100 |
| 네이버 인증 | edb3efc31035cbfe5e824585be1cd9a5aebacfac | 인증 완료 |
| Grok API | (환경변수로 관리) | 하드코딩 금지 |

---

## 💡 Claude Code를 위한 핵심 지침

1. **이 문서의 What/Why/제약조건을 따른다.** How는 자율.
2. **Design_Skills.md를 참고하여** 디자인 퀄리티를 높인다.
3. **모바일 퍼스트.** Lighthouse 90+ 목표.
4. **한국어 텍스트**는 i18n 파일에서 관리.
5. **API 키 보안:** 환경변수로만 관리.
6. **프롬프트는 이 문서의 확정본을 사용.** 임의 수정 금지.
7. **문서 자율 업데이트 권한:** 중요 변화 시 Claude.md, Design_Skills.md 직접 업데이트. 변경 이력 기록.

---

## 🔑 의사결정 기록

| 결정 | 선택 | 이유 |
|------|------|------|
| AI 엔진 | Grok (xAI) | 속도↑, 비용↓($0.02~$0.07), 저작권 캐릭터 지원, Data Sharing으로 월 $150 무료. GPT는 품질↑이나 비용↑, 저작권 거부 |
| 프롬프트 언어 | 한국어 | Grok은 짧고 자연스러운 한국어 지시에 최적 반응 |
| Edge Detection | 폐기 | 캐니/소벨 품질 미달 |
| Next.js | 비채택 | 이미 Astro로 라이브. 전환 불필요 |
| 프레임워크 | Astro + Cloudflare | 정적 최적화, 무제한 대역폭, 무료 |

---

## 📝 변경 이력
| 날짜 | 변경 내용 |
|------|----------|
| 프로젝트 시작 | 초기 문서 작성 |
| 2026-02-20 | Sprint 1~4 완료 (Astro, Edge Detection, 다운로드, 공유, 랜딩, GA4, SEO) |
| 2026-02-22 | Edge Detection → AI API 전환 결정 |
| 2026-02-22 | GA4 ID 수정 (N→W), 네이버 웹마스터 인증 완료 |
| 2026-02-23 | **AI 엔진 확정: Grok (xAI)** |
| 2026-02-23 | 기능 3가지 확정 (배경 유지/제거/창작) |
| 2026-02-23 | 난이도 3단계 추가 (상/중/하) |
| 2026-02-23 | 한국어 프롬프트 v1 확정 (100장 테스트 완료) |
